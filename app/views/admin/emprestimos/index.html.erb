<%# app/views/admin/emprestimos/index.html.erb %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1>Gerenciar Empréstimos</h1>
  <%= link_to "Novo Empréstimo", new_admin_emprestimo_path, class: "btn btn-primary" %>
</div>

<div class="table-responsive">
  <table class="table table-striped table-hover align-middle">
    <thead class="table-dark">
      <tr>
        <th scope="col">ID</th>
        <th scope="col">Status</th>
        <th scope="col">Locatário</th>
        <th scope="col">Carro</th>
        <th scope="col">Valor Total</th>
        <th scope="col" class="text-end">Ações</th>
      </tr>
    </thead>
    <tbody>
      <% @emprestimos.each do |emp| %>
        <tr>
          <td><strong>#<%= emp.id %></strong></td>
          <td>
            <%# Define a cor do 'badge' com base no status %>
            <% status_color = case emp.status
                             when 'Devolvido' then 'bg-success'
                             when 'Locado' then 'bg-warning'
                             when 'Pendente' then 'bg-info'
                             else 'bg-secondary'
                             end %>
            <span class="badge <%= status_color %> fs-6"><%= emp.status %></span>
          </td>
          <td><%= emp.locatario.try(:nome) || 'Usuário excluído' %></td>
          <td><%= emp.carro.try(:nome) || 'Carro excluído' %></td>
          <td><%= number_to_currency(emp.valor_total) %></td>
          <td class="text-end">
            <%# --- ESTAS SÃO AS CORREÇÕES --- %>
            <%# Usamos [:admin, emp] para apontar para a rota admin_emprestimo_path(emp) %>
            <%# Isto vai corrigir o seu erro 'RecordNotFound' %>
            <%= link_to "Ver", [:admin, emp], class: "btn btn-sm btn-info" %>
            <%= link_to "Editar", edit_admin_emprestimo_path(emp), class: "btn btn-sm btn-secondary" %>
            <%= button_to "Excluir", [:admin, emp], method: :delete, data: { turbo_confirm: 'Tem certeza?' }, class: "btn btn-sm btn-danger d-inline" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
<%# app/views/admin/emprestimos/_form.html.erb %>

<%# --- CORREÇÃO 1: A Rota --- %>
<%# Adicionamos '[:admin, ...]' para corrigir o Routing Error %>
<%= form_with(model: [:admin, emprestimo]) do |form| %>
  <div class="card shadow-sm border-0">
    <div class="card-body bg-light">
      
      <% if emprestimo.errors.any? %>
        <div class="alert alert-danger">
          <h5><%= pluralize(emprestimo.errors.count, "erro") %> impediram o salvamento:</h5>
          <ul class="mb-0">
            <% emprestimo.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <%# --- MELHORIA: Campo de Status --- %>
      <%# Trocamos o campo de texto por um dropdown (select) %>
      <div class="mb-3">
        <%= form.label :status, class: "form-label fw-semibold" %>
        <%= form.select :status, 
              options_for_select(['Pendente', 'Locado', 'Devolvido', 'Cancelado'], emprestimo.status), 
              { prompt: 'Selecione um status' }, 
              { class: "form-select" } %>
      </div>

    </div>

    <div class="card-footer bg-white d-flex justify-content-between align-items-center">
      <%= link_to "← Voltar para empréstimos", admin_emprestimos_path, class: "btn btn-outline-secondary" %>
      
      <%# --- CORREÇÃO 2 e 3: O Botão --- %>
      <%= form.submit "Atualizar Empréstimo", class: "btn btn-primary" %>
    </div>
  </div>
<% end %>
<div class="container mt-5">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-4">
    <h1 class="fw-bold text-primary mb-3 mb-md-0">
      ðŸš˜ Nossos Carros para LocaÃ§Ã£o
    </h1>
    <div class="btn-group shadow-sm" role="group">
      <%= link_to "Exportar CSV", carros_path(format: :csv), class: "btn btn-outline-success" %>
      <%= link_to "Gerar PDF", carros_path(format: :pdf), class: "btn btn-outline-danger", target: :_blank %>
    </div>
  </div>

  <% unless locatario_signed_in? %>
    <p class="lead text-muted mb-4">
      Confira os veÃ­culos disponÃ­veis para locaÃ§Ã£o.
      <%= link_to "FaÃ§a login", new_locatario_session_path, class: "link-primary text-decoration-none fw-semibold" %> 
      ou 
      <%= link_to "cadastre-se", new_locatario_registration_path, class: "link-primary text-decoration-none fw-semibold" %> 
      para garantir o seu carro hoje mesmo!
    </p>
  <% end %>

  <div class="card shadow-sm mb-5 border-0">
    <div class="card-body">
      <%= form_with url: carros_path, method: :get, local: true, class: "row g-3 align-items-end" do %>
        <div class="col-md-4">
          <%= label_tag :query, "Buscar", class: "form-label fw-semibold" %>
          <%= text_field_tag :query, params[:query], placeholder: "Nome, marca ou placa", class: "form-control shadow-sm" %>
        </div>
        <div class="col-md-3">
          <%= label_tag :marca, "Marca", class: "form-label fw-semibold" %>
          <%= select_tag :marca, options_for_select(Carro.distinct.pluck(:marca), params[:marca]), include_blank: "Todas", class: "form-select shadow-sm" %>
        </div>
        <div class="col-md-2">
          <%= label_tag :cambio, "CÃ¢mbio", class: "form-label fw-semibold" %>
          <%= select_tag :cambio, options_for_select(["manual", "automatico"], params[:cambio]), include_blank: "Todos", class: "form-select shadow-sm" %>
        </div>
        <div class="col-md-2">
          <%= label_tag :combustivel, "CombustÃ­vel", class: "form-label fw-semibold" %>
          <%= select_tag :combustivel, options_for_select(["gasolina", "alcool", "flex", "diesel"], params[:combustivel]), include_blank: "Todos", class: "form-select shadow-sm" %>
        </div>
        <div class="col-md-1 d-grid">
          <%= submit_tag "Filtrar", class: "btn btn-outline-primary fw-semibold shadow-sm" %>
        </div>
        <div class="col-md-12 d-flex justify-content-end">
          <%= link_to "Limpar filtros", carros_path, class: "btn btn-link text-secondary text-decoration-none" %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="row row-cols-1 row-cols-md-3 g-4">
    <% if @carros.any? %>
      <% @carros.each do |carro| %>
        <div class="col">
          <div class="card h-100 border-0 shadow-sm hover-shadow transition">
            <div class="card-body">
              <h5 class="card-title text-dark fw-bold"><%= carro.marca %> <%= carro.nome %></h5>
              <p class="card-text mb-3">
                <span class="d-block"><strong>Cor:</strong> <%= carro.cor %></span>
                <span class="d-block"><strong>Ano:</strong> <%= carro.ano.year %></span> 
                <span class="d-block"><strong>Placa:</strong> <%= carro.placa %></span>
              </p>
              <h4 class="text-success fw-bold"><%= number_to_currency(carro.valor_diaria) %>/dia</h4>
            </div>
            <div class="card-footer bg-transparent border-0 pb-4">
              <% if locatario_signed_in? %>
                <%# --- ESTA Ã‰ A CORREÃ‡ÃƒO DO LINK --- %>
                <%# Mudamos de 'new_emprestimo_path(carro_id: carro.id)' %>
                <%# para 'new_carro_emprestimo_path(carro)' %>
                <%= link_to "Alugar este Carro", new_carro_emprestimo_path(carro), class: "btn btn-primary w-100 shadow-sm" %>
              <% else %>
                <%= link_to "FaÃ§a login para alugar", new_locatario_session_path, class: "btn btn-primary w-100 shadow-sm" %>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="text-center text-muted mt-5">
        <h5>Nenhum carro encontrado ðŸ˜•</h5>
        <p>Tente ajustar os filtros ou refazer a busca.</p>
      </div>
    <% end %>
  </div>

  <div class="d-flex justify-content-center mt-5">
    <%= paginate @carros %>
  </div>
</div>

<style>
  .hover-shadow:hover {
    transform: translateY(-5px);
    transition: 0.2s ease;
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.1);
  }
</style>